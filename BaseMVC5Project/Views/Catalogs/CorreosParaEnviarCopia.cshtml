@model MigracionTalentoExtranjero.Models.Catalogs.CatalogoGeneral
@{

}
<div>
    <p>
        <img src="~/Assets/logo_ocesa.png" height="100px" />
        <button type="button" onclick="mostrarModalVacio()" class="btn btn-info" text-align:right;>CREAR NUEVO ELEMENTO</button>
    </p>
</div>
<div class="panel panel-default">
    <!-- Default panel contents -->

    <div class="panel-heading">CATÁLOGO CORREOS PARA ENVIAR COPIA DE PROCESO</div>
    <div class="panel-body">
        <!-- Table -->
        <table class="table" id="registerFound">
            <tr>
                <th>IDENTIFICADOR</th>
                <th>CORREO</th>
                <th>ACTIVAR</th>
                <th>ACTUALIZAR ESTATUS</th>
            </tr>
            @if (ViewBag.CatalogList != null)
            {
                foreach (MigracionTalentoExtranjero.Models.Catalogs.CatalogoGeneral registro in ViewBag.CatalogList)
                {
                <tr>
                    <td style="vertical-align:middle;">@registro.Id</td>
                    <td style="vertical-align:middle;">@registro.Descripcion</td>
                    <td style="vertical-align:middle;">
                        @Html.CheckBox($"check_{registro.Id.ToString()}", registro.Activo)
                    </td>
                    <td>
                        <button type="button" onclick="GuardarCatalogo(@registro.Id)" >Actualizar</button>
                    </td>
                </tr>
                }
            }

            <!-- SECCION PARA GENERAR NUEVO ELEMENTO -->
            <tr>
                <td style="vertical-align:middle;">-</td>
                <td style="vertical-align:middle;">@Html.TextBoxFor(m=> m.Descripcion)</td>
                
                <td style="vertical-align:middle;">Activo</td>
                <td>
                    <button type="button" onclick="GuardarCatalogo(0)" class="btn-block">Crear elemento</button>
                </td>
            </tr>
        </table>
    </div>

</div>


<div class="contenedor-modales" id="containerAlert">
    <div class="contenido-modal2">
        <div class="p-2" style="width:30px; float: right; margin-top:10px;">
            <span onclick="cerrarModalAlert()" style="cursor: pointer; color: crimson; font-weight:bold; font-size:14px;">X</span>
        </div>
        <div class="contenido-modal-grupos">
            <hr>
            <p class="subtitulos-modal">Resultado</p>
            <hr>
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div id="modalAlertMessageResult"></div>
                </div>
            </div>
            <button onclick="cerrarModalAlert()" class="btn-block">Cerrar</button>
        </div>
    </div>
</div>






<script type="text/javascript">

    let accionCRUD = '';
    let popupAlert = document.getElementById('containerAlert');
    let accionPopupAlert = '';


    function obtenerIdDelFinal(myIdString) {

        let arrSplit = myIdString.split('_');
        let currentId = arrSplit[arrSplit.length - 1];
        return currentId;
    }


    document.addEventListener("DOMContentLoaded", function () {
        hideLoader();


    });

    
    function cerrarModal() {
        console.log("CLIC EN CERRAR")
        let popup = document.getElementById('container');
        popup.classList.remove('show');
    }

    function cerrarModalAlert() {
        popupAlert.classList.remove('show');
        evaluaAccionPopUpAlert(accionPopupAlert);
    }


    async function GuardarCatalogo(id) {
        try{
            showLoader();
            let url = "";
            let email = "";
            let activo = 0;

            if (id === 0) {
                url = "@Url.Content("~/Catalogs/CreaNuevoElementoCatalogo")";
                email = $("#Descripcion").val();
                activo = 1;
            }
            else {
                url = "@Url.Content("~/Catalogs/ActualizarElementoCatalogo")";
                activo = $(`#check_${id}`).prop('checked');
            }

            console.log(`Valor de email: ${email}`);

            let params =
            {
                Id: id,
                NombreCatalogo: "CORREOSPARACOPIA",
                Descripcion: email,
                Activo: activo
                //AtributoAdicionalStr1: AtributoAdicionalStr1.value,
            };

            const response = httpPost(
                url,
                params
            );
            const dataResponse = await response
                .then(data => {
                    return data;
                })
                .catch(error => {
                    console.log(error);
                });

            if (dataResponse.response === false) {
                let messageError = dataResponse.message;
                //setErrorMessageForm(messageError, 'modalEditarRegistroMensajeError');
                setErrorMessageForm(messageError, 'modalAlertMessageResult');
                popupAlert.classList.add('show');
            }
            else {
                setSuccessMessageForm(dataResponse.message, 'modalAlertMessageResult');
                accionPopupAlert = 'REFRESCAR';
            }
            popupAlert.classList.add('show');
        }
        catch (error) {
            console.error(error);
        }
        finally {
            hideLoader();
        }
    }


    function evaluaAccionPopUpAlert(accion) {
        switch (accion) {
            case 'REFRESCAR':
                window.location.reload();
                break;
            default:
                return;
                break;
        }
    }

</script>